<%- include('includes/head.ejs') %>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f7f7f7;
  }

  h1 {
    text-align: center;
    margin-top: 20px;
  }

  div {
    margin: 20px auto;
    width: 80%;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  label {
    font-weight: bold;
    margin-bottom: 10px;
  }

  input[type="text"] {
    padding: 5px;
    font-size: 16px;
    border: none;
    border-radius: 5px;
    box-shadow: 2px 2px 2px #ccc;
    margin-bottom: 10px;
    width: 100%;
    max-width: 400px;
  }

  button {
    padding: 8px;
    background-color: #4CAF50;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    box-shadow: 2px 2px 2px #ccc;
    margin-bottom: 20px;
    width: 100%;
    max-width: 400px;
  }

  button:hover {
    background-color: #3e8e41;
  }

  #songs {
    margin: 20px auto;
    width: 80%;
    max-width: 600px;
    list-style: none;
    padding: 0;
  }

  #songs li {
    padding: 10px;
    background-color: #fff;
    border: 1px solid #ccc;
    margin-bottom: 10px;
    border-radius: 5px;
    box-shadow: 2px 2px 2px #ccc;
    font-size: 16px;
  }

  #songs li:last-child {
    margin-bottom: 0;
  }

  #suggestions {
    margin-top: 10px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
  }

  #suggestions button {
    padding: 5px 8px;
    margin: 5px;
    background-color: #4CAF50;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    box-shadow: 2px 2px 2px #ccc;
  }

  #suggestions button:hover {
    background-color: #3e8e41;
  }
</style>
<header>
  <!-- :::::La línea de búsqueda::::: -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
      <a class="navbar-brand" href="/">
        <img src="/assets/logos/CYM.png" alt="" width="" height="70" />
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="/index">Inicio</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/historia">Historia</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="laboratorio.html">Laboratorio de Calibración</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="servicios.html">Nuestros Servicios</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Productos
            </a>
            <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
              <li>
                <a class="dropdown-item" href="/lista">Añadir producto</a>
              </li>
            </ul>
          </li>
        </ul>
        <% if(isLoggedIn) { %>
        <span class="navbar-item ms-auto">Hola <%= nombre %> | </span>
        <a href="/logout" class="btn btn-danger btn-sm"> Log out </a>
        <% } %>
      </div>
    </div>
  </nav>
</header>

<section>
  <div class="container mt-5 mb-5">
    <h1>Pokemon</h1>
    <input type="text" id="pokemon-name" placeholder="Enter Pokemon name">
    <button onclick="searchPokemon()">Search</button>
    <div class="mt-5" id="pokemon-data"></div>
  </div>
</section>

<section>
  <div class="container mt-5 mb-5">
    <div>
      <label for="search">Search for an artist:</label>
      <input type="text" id="search" name="search" oninput="getSuggestions()">
      <div id="suggestions"></div>
      <button onclick="getRandomSongs()">Get 10 Random Songs</button>
    </div>
    <ul id="songs"></ul>
  </div>
</section>

<script>
  const searchPokemon = async () => {
    const pokemonName = document.getElementById("pokemon-name").value;
    const url = `https://pokeapi.co/api/v2/pokemon/${pokemonName}/`;
    try {
      const response = await fetch(url);
      const pokemonData = await response.json();
      console.log(pokemonData);
      displayPokemonData(pokemonData);
    } catch (error) {
      console.error(error);
    }
  };

  const displayPokemonData = (pokemonData) => {
    const pokemonDiv = document.getElementById("pokemon-data");
    pokemonDiv.innerHTML = `
        <h2>${pokemonData.name}</h2>
        <img src="${pokemonData.sprites.front_default}" alt="${pokemonData.name}">
        <p>Type: ${pokemonData.types[0].type.name}</p>
        <p>Weight: ${pokemonData.weight}</p>
        <p>Height: ${pokemonData.height}</p>
      `;
  };

  function getSuggestions() {
    const apiKey = 'c252789f4f7e7057a2080aa7fb7825e9';
    const searchInput = document.getElementById('search').value;
    const url = `http://ws.audioscrobbler.com/2.0/?method=artist.search&artist=${searchInput}&api_key=${apiKey}&format=json`;

    fetch(url)
      .then(response => response.json())
      .then(data => {
        const suggestions = data.results.artistmatches.artist.map(artist => artist.name);
        const suggestionsContainer = document.getElementById('suggestions');
        suggestionsContainer.innerHTML = '';
        suggestions.forEach(suggestion => {
          const button = document.createElement('button');
          button.textContent = suggestion;
          button.onclick = () => document.getElementById('search').value = suggestion;
          suggestionsContainer.appendChild(button);
        });
      });
  }

  function getRandomSongs() {
    const apiKey = 'c252789f4f7e7057a2080aa7fb7825e9';
    const artistName = document.getElementById('search').value;
    const url = `http://ws.audioscrobbler.com/2.0/?method=artist.gettoptracks&artist=${artistName}&api_key=${apiKey}&format=json`;

    fetch(url)
      .then(response => response.json())
      .then(data => {
        const songs = data.toptracks.track;
        const songList = document.getElementById('songs');
        songList.innerHTML = '';

        for (let i = 0; i < 10; i++) {
          const randomIndex = Math.floor(Math.random() * songs.length);
          const song = songs[randomIndex];

          const li = document.createElement('li');
          li.textContent = `${song.name} by ${song.artist.name}`;
          songList.appendChild(li);
        }
      });
  }
</script>